
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Despensa Tia Malen - Sistema de Gesti√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #ccc;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.4",
    "react/": "https://esm.sh/react@^19.2.4/",
    "recharts": "https://esm.sh/recharts@^3.7.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useMemo } from 'https://esm.sh/react@19.2.4';
        import ReactDOM from 'https://esm.sh/react-dom@19.2.4/client';
        import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell } from 'https://esm.sh/recharts';

        // --- Types & Constants ---
        const View = {
            POS: 'pos',
            INVENTORY: 'inventory',
            SALES_HISTORY: 'history',
            DASHBOARD: 'dashboard'
        };

        const STORAGE_KEYS = {
            PRODUCTS: 'tia_malen_products',
            SALES: 'tia_malen_sales'
        };

        const INITIAL_PRODUCTS = [
            { id: '1', name: 'Leche Entera 1L', price: 1200, stock: 24, category: 'L√°cteos' },
            { id: '2', name: 'Pan Felipe (kg)', price: 1500, stock: 10, category: 'Panader√≠a' },
            { id: '3', name: 'Yerba Mate 500g', price: 2800, stock: 15, category: 'Almac√©n' },
            { id: '4', name: 'Aceite Girasol 900ml', price: 1800, stock: 8, category: 'Almac√©n' },
            { id: '5', name: 'Gaseosa Cola 2.25L', price: 2200, stock: 12, category: 'Bebidas' },
        ];

        // --- Components ---

        const Sidebar = ({ currentView, setView }) => {
            const menuItems = [
                { id: View.POS, label: 'Ventas (POS)', icon: 'üõí' },
                { id: View.INVENTORY, label: 'Inventario', icon: 'üì¶' },
                { id: View.SALES_HISTORY, label: 'Historial', icon: 'üìú' },
                { id: View.DASHBOARD, label: 'Panel Control', icon: 'üìä' },
            ];

            return React.createElement('aside', { className: 'w-64 bg-white border-r border-gray-200 flex flex-col h-full shadow-sm hidden md:flex' },
                React.createElement('div', { className: 'p-6 border-b border-gray-100' },
                    React.createElement('div', { className: 'flex items-center gap-3' },
                        React.createElement('div', { className: 'w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center text-white text-xl font-bold' }, 'TM'),
                        React.createElement('span', { className: 'text-xl font-bold text-gray-800' }, 'Tia Malen')
                    )
                ),
                React.createElement('nav', { className: 'flex-1 p-4 space-y-2' },
                    menuItems.map(item => 
                        React.createElement('button', {
                            key: item.id,
                            onClick: () => setView(item.id),
                            className: `w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${
                                currentView === item.id ? 'bg-orange-50 text-orange-600 font-semibold' : 'text-gray-600 hover:bg-gray-50'
                            }`
                        },
                            React.createElement('span', { className: 'text-xl' }, item.icon),
                            React.createElement('span', null, item.label)
                        )
                    )
                ),
                React.createElement('div', { className: 'p-4 border-t border-gray-100' },
                    React.createElement('div', { className: 'bg-orange-50 p-4 rounded-xl' },
                        React.createElement('p', { className: 'text-xs font-semibold text-orange-600 uppercase tracking-wider mb-1' }, 'Usuario'),
                        React.createElement('p', { className: 'text-sm font-bold text-gray-800' }, 'Administrador')
                    )
                )
            );
        };

        const POS = ({ products, onCompleteSale }) => {
            const [cart, setCart] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [paymentMethod, setPaymentMethod] = useState('Efectivo');

            const filteredProducts = useMemo(() => {
                return products.filter(p => 
                    p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    p.category.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }, [products, searchTerm]);

            const addToCart = (product) => {
                if (product.stock <= 0) return;
                setCart(prev => {
                    const existing = prev.find(item => item.id === product.id);
                    if (existing) {
                        if (existing.quantity >= product.stock) return prev;
                        return prev.map(item => item.id === product.id ? { ...item, quantity: item.quantity + 1 } : item);
                    }
                    return [...prev, { ...product, quantity: 1 }];
                });
            };

            const updateQuantity = (productId, delta) => {
                setCart(prev => prev.map(item => {
                    if (item.id === productId) {
                        const newQty = Math.max(1, item.quantity + delta);
                        const productRef = products.find(p => p.id === productId);
                        if (productRef && newQty > productRef.stock) return item;
                        return { ...item, quantity: newQty };
                    }
                    return item;
                }));
            };

            const total = cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);

            const handleCheckout = () => {
                if (cart.length === 0) return;
                onCompleteSale({
                    id: Date.now().toString(),
                    timestamp: Date.now(),
                    items: [...cart],
                    total,
                    paymentMethod
                });
                setCart([]);
                alert('Venta confirmada');
            };

            return React.createElement('div', { className: 'flex flex-col lg:flex-row gap-6 h-[calc(100vh-180px)]' },
                // Productos
                React.createElement('div', { className: 'flex-1 flex flex-col min-h-0 bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden' },
                    React.createElement('div', { className: 'p-4 border-b border-gray-100' },
                        React.createElement('input', {
                            type: 'text',
                            placeholder: 'Buscar productos...',
                            className: 'w-full pl-4 pr-4 py-3 bg-gray-50 rounded-xl border-none focus:ring-2 focus:ring-orange-500 outline-none',
                            value: searchTerm,
                            onChange: (e) => setSearchTerm(e.target.value)
                        })
                    ),
                    React.createElement('div', { className: 'flex-1 overflow-y-auto p-4 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4' },
                        filteredProducts.map(p => React.createElement('button', {
                            key: p.id,
                            onClick: () => addToCart(p),
                            disabled: p.stock <= 0,
                            className: `text-left p-4 rounded-xl border transition-all flex flex-col justify-between ${
                                p.stock <= 0 ? 'bg-gray-50 opacity-60' : 'bg-white border-gray-100 hover:border-orange-500 hover:shadow-md'
                            }`
                        },
                            React.createElement('div', null,
                                React.createElement('span', { className: 'text-[10px] font-bold text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full uppercase' }, p.category),
                                React.createElement('h3', { className: 'font-bold text-gray-800 mt-2' }, p.name)
                            ),
                            React.createElement('div', { className: 'mt-4 flex items-center justify-between' },
                                React.createElement('span', { className: 'text-lg font-black' }, `$${p.price.toLocaleString()}`),
                                React.createElement('span', { className: 'text-xs text-gray-400' }, `Stock: ${p.stock}`)
                            )
                        ))
                    )
                ),
                // Carrito
                React.createElement('div', { className: 'w-full lg:w-96 flex flex-col bg-white rounded-2xl shadow-sm border border-gray-100' },
                    React.createElement('div', { className: 'p-4 border-b border-gray-100 font-bold text-gray-800' }, 'Carrito'),
                    React.createElement('div', { className: 'flex-1 overflow-y-auto p-4 space-y-3' },
                        cart.length === 0 ? React.createElement('div', { className: 'h-full flex items-center justify-center text-gray-400' }, 'Vac√≠o') :
                        cart.map(item => React.createElement('div', { key: item.id, className: 'flex items-center gap-2 bg-gray-50 p-2 rounded-lg' },
                            React.createElement('div', { className: 'flex-1 text-sm' }, item.name),
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement('button', { onClick: () => updateQuantity(item.id, -1), className: 'w-6 h-6 bg-white rounded border' }, '-'),
                                React.createElement('span', { className: 'w-4 text-center font-bold' }, item.quantity),
                                React.createElement('button', { onClick: () => updateQuantity(item.id, 1), className: 'w-6 h-6 bg-white rounded border' }, '+')
                            ),
                            React.createElement('button', { onClick: () => setCart(cart.filter(i => i.id !== item.id)), className: 'text-red-400 text-xs' }, '‚úï')
                        ))
                    ),
                    React.createElement('div', { className: 'p-4 border-t border-gray-100 bg-gray-50 rounded-b-2xl' },
                        React.createElement('div', { className: 'flex justify-between font-black text-xl mb-4' },
                            React.createElement('span', null, 'Total'),
                            React.createElement('span', null, `$${total.toLocaleString()}`)
                        ),
                        React.createElement('button', {
                            onClick: handleCheckout,
                            disabled: cart.length === 0,
                            className: 'w-full py-4 bg-orange-500 text-white font-bold rounded-xl disabled:bg-gray-300'
                        }, 'Finalizar Venta')
                    )
                )
            );
        };

        const Inventory = ({ products, onUpdate, onDelete, onAdd }) => {
            const [form, setForm] = useState({ name: '', price: 0, stock: 0, category: 'Almac√©n' });
            const [isAdding, setIsAdding] = useState(false);
            const [editId, setEditId] = useState(null);

            const save = (e) => {
                e.preventDefault();
                if (editId) {
                    onUpdate({ ...form, id: editId });
                    setEditId(null);
                } else {
                    onAdd({ ...form, id: Date.now().toString() });
                }
                setForm({ name: '', price: 0, stock: 0, category: 'Almac√©n' });
                setIsAdding(false);
            };

            return React.createElement('div', { className: 'space-y-6' },
                React.createElement('div', { className: 'flex justify-between items-center' },
                    React.createElement('h2', { className: 'text-xl font-bold' }, 'Gesti√≥n de Productos'),
                    React.createElement('button', {
                        onClick: () => { setIsAdding(true); setEditId(null); },
                        className: 'bg-orange-500 text-white px-4 py-2 rounded-lg font-bold'
                    }, '+ Nuevo')
                ),
                isAdding && React.createElement('form', { onSubmit: save, className: 'bg-white p-6 rounded-2xl border border-orange-100 grid grid-cols-1 md:grid-cols-4 gap-4' },
                    React.createElement('input', { placeholder: 'Nombre', className: 'p-2 bg-gray-50 rounded', value: form.name, onChange: e => setForm({ ...form, name: e.target.value }), required: true }),
                    React.createElement('input', { type: 'number', placeholder: 'Precio', className: 'p-2 bg-gray-50 rounded', value: form.price, onChange: e => setForm({ ...form, price: Number(e.target.value) }), required: true }),
                    React.createElement('input', { type: 'number', placeholder: 'Stock', className: 'p-2 bg-gray-50 rounded', value: form.stock, onChange: e => setForm({ ...form, stock: Number(e.target.value) }), required: true }),
                    React.createElement('select', { className: 'p-2 bg-gray-50 rounded', value: form.category, onChange: e => setForm({ ...form, category: e.target.value }) },
                        ['Almac√©n', 'L√°cteos', 'Panader√≠a', 'Bebidas', 'Limpieza'].map(c => React.createElement('option', { key: c, value: c }, c))
                    ),
                    React.createElement('div', { className: 'md:col-span-4 flex justify-end gap-2' },
                        React.createElement('button', { type: 'button', onClick: () => setIsAdding(false), className: 'text-gray-400' }, 'Cancelar'),
                        React.createElement('button', { type: 'submit', className: 'bg-orange-500 text-white px-6 py-2 rounded-lg' }, 'Guardar')
                    )
                ),
                React.createElement('div', { className: 'bg-white rounded-2xl border border-gray-100 overflow-hidden' },
                    React.createElement('table', { className: 'w-full' },
                        React.createElement('thead', { className: 'bg-gray-50 text-xs font-bold text-gray-400 uppercase' },
                            React.createElement('tr', null,
                                React.createElement('th', { className: 'p-4 text-left' }, 'Producto'),
                                React.createElement('th', { className: 'p-4 text-left' }, 'Categor√≠a'),
                                React.createElement('th', { className: 'p-4 text-right' }, 'Precio'),
                                React.createElement('th', { className: 'p-4 text-right' }, 'Stock'),
                                React.createElement('th', { className: 'p-4 text-center' }, 'Acciones')
                            )
                        ),
                        React.createElement('tbody', { className: 'divide-y' },
                            products.map(p => React.createElement('tr', { key: p.id },
                                React.createElement('td', { className: 'p-4 font-bold' }, p.name),
                                React.createElement('td', { className: 'p-4' }, React.createElement('span', { className: 'text-[10px] bg-gray-100 p-1 rounded uppercase' }, p.category)),
                                React.createElement('td', { className: 'p-4 text-right' }, `$${p.price}`),
                                React.createElement('td', { className: 'p-4 text-right' }, p.stock),
                                React.createElement('td', { className: 'p-4 text-center space-x-2' },
                                    React.createElement('button', { onClick: () => { setEditId(p.id); setForm(p); setIsAdding(true); } }, '‚úèÔ∏è'),
                                    React.createElement('button', { onClick: () => confirm('¬øEliminar?') && onDelete(p.id) }, 'üóëÔ∏è')
                                )
                            ))
                        )
                    )
                )
            );
        };

        const SalesHistory = ({ sales }) => {
            return React.createElement('div', { className: 'bg-white rounded-2xl border border-gray-100 overflow-hidden' },
                React.createElement('table', { className: 'w-full' },
                    React.createElement('thead', { className: 'bg-gray-50 text-xs font-bold text-gray-400 uppercase' },
                        React.createElement('tr', null,
                            React.createElement('th', { className: 'p-4 text-left' }, 'Fecha'),
                            React.createElement('th', { className: 'p-4 text-left' }, 'Productos'),
                            React.createElement('th', { className: 'p-4 text-right' }, 'Total')
                        )
                    ),
                    React.createElement('tbody', { className: 'divide-y' },
                        sales.map(s => React.createElement('tr', { key: s.id },
                            React.createElement('td', { className: 'p-4 text-sm' }, new Date(s.timestamp).toLocaleString()),
                            React.createElement('td', { className: 'p-4 text-xs' }, s.items.map(i => `${i.quantity}x ${i.name}`).join(', ')),
                            React.createElement('td', { className: 'p-4 text-right font-black' }, `$${s.total.toLocaleString()}`)
                        ))
                    )
                )
            );
        };

        const Dashboard = ({ sales, products }) => {
            const metrics = useMemo(() => {
                const total = sales.reduce((acc, s) => acc + s.total, 0);
                const lowStock = products.filter(p => p.stock < 5).length;
                const counts = {};
                sales.forEach(s => s.items.forEach(i => counts[i.name] = (counts[i.name] || 0) + i.quantity));
                const chartData = Object.entries(counts).map(([name, count]) => ({ name, count })).sort((a,b) => b.count-a.count).slice(0,5);
                return { total, lowStock, chartData };
            }, [sales, products]);

            return React.createElement('div', { className: 'space-y-6' },
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                    React.createElement('div', { className: 'bg-white p-6 rounded-2xl border border-gray-100' },
                        React.createElement('p', { className: 'text-xs text-gray-400 font-bold uppercase' }, 'Total Facturado'),
                        React.createElement('h4', { className: 'text-3xl font-black text-orange-600' }, `$${metrics.total.toLocaleString()}`)
                    ),
                    React.createElement('div', { className: 'bg-white p-6 rounded-2xl border border-gray-100' },
                        React.createElement('p', { className: 'text-xs text-gray-400 font-bold uppercase' }, 'Alertas de Stock'),
                        React.createElement('h4', { className: 'text-3xl font-black text-red-500' }, metrics.lowStock)
                    )
                ),
                React.createElement('div', { className: 'bg-white p-6 rounded-2xl border border-gray-100 h-80' },
                    React.createElement('h3', { className: 'font-bold mb-4' }, 'Top 5 M√°s Vendidos'),
                    React.createElement(ResponsiveContainer, { width: '100%', height: '100%' },
                        React.createElement(BarChart, { data: metrics.chartData },
                            React.createElement(CartesianGrid, { strokeDasharray: '3 3', vertical: false }),
                            React.createElement(XAxis, { dataKey: 'name', tick: { fontSize: 10 } }),
                            React.createElement(YAxis, null),
                            React.createElement(Tooltip, null),
                            React.createElement(Bar, { dataKey: 'count', fill: '#f97316', radius: [4, 4, 0, 0] })
                        )
                    )
                )
            );
        };

        const App = () => {
            const [currentView, setCurrentView] = useState(View.POS);
            const [products, setProducts] = useState(() => JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS)) || INITIAL_PRODUCTS);
            const [sales, setSales] = useState(() => JSON.parse(localStorage.getItem(STORAGE_KEYS.SALES)) || []);

            useEffect(() => localStorage.setItem(STORAGE_KEYS.PRODUCTS, JSON.stringify(products)), [products]);
            useEffect(() => localStorage.setItem(STORAGE_KEYS.SALES, JSON.stringify(sales)), [sales]);

            const onCompleteSale = (sale) => {
                setSales([sale, ...sales]);
                setProducts(products.map(p => {
                    const item = sale.items.find(i => i.id === p.id);
                    return item ? { ...p, stock: p.stock - item.quantity } : p;
                }));
            };

            const renderView = () => {
                switch(currentView) {
                    case View.POS: return React.createElement(POS, { products, onCompleteSale });
                    case View.INVENTORY: return React.createElement(Inventory, { products, onUpdate: p => setProducts(products.map(old => old.id === p.id ? p : old)), onDelete: id => setProducts(products.filter(p => p.id !== id)), onAdd: p => setProducts([...products, p]) });
                    case View.SALES_HISTORY: return React.createElement(SalesHistory, { sales });
                    case View.DASHBOARD: return React.createElement(Dashboard, { sales, products });
                    default: return null;
                }
            };

            return React.createElement('div', { className: 'flex h-screen bg-gray-50 overflow-hidden' },
                React.createElement(Sidebar, { currentView, setView: setCurrentView }),
                React.createElement('main', { className: 'flex-1 overflow-y-auto p-4 md:p-8' },
                    React.createElement('header', { className: 'mb-8' },
                        React.createElement('h1', { className: 'text-3xl font-black text-gray-800' }, 'Despensa Tia Malen'),
                        React.createElement('p', { className: 'text-gray-400 font-medium' }, currentView.toUpperCase())
                    ),
                    renderView()
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(React.StrictMode, null, React.createElement(App)));
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
